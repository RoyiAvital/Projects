# Calculate Distance Matrix

## Introduction
This project tries to compare different methods to calculate the Distance Matrix between 2 set of vectors.  
The projects compares 4 different approaches:
 *  Using MATLAB.
 *  Using Vanilla C Implementation.  
    The C Implementation will compiled using 3 different compilers (MSVC 2017 15.6.6, Intel Compiler 18.1, GCC 7,3) with highest optimization levels.
 *  Using SSE / AVX Intrinsics Code.  
    Using SSE / AVX intrinsics code to be compleletly insensitive to compiler.
 *  Using Eigen.


## Implementation Notes

 *  There are 2 matrices $ A \in \mathbb{R}^{k \times m} $, $ B \in \mathbb{R}^{k \times n} $ which are a set of vectors in $ \mathbb{R}^{k} $.  
 *  The distance matrix $ D \in \mathbb{R}^{m \times n} $ is given by $ {D}_{ij} = {\left\| {A}_{i} - {B}_{j} \right\|}_{2}^{2} $ where $ {A}_{i} $ is the $ i $ -th vector in the set $ A $ (Namely the $ i $ -th column os the matrix).  
 *  In matrix form the first index is the one which is contiguous in memory. This means in MATLAB those are the columns of the array while in C those are the rows of the array.
 *  Vanillat Implementation - Tries to be compiler friendly and let the compiler do the Vectorization.
 *  SSE / AVX Implementation - Implement the distance calculation between 2 vectors using SIMD (`SSE4` / `AVX2`) Intrinsics (See [Intel Intrinsics Guide](https://software.intel.com/sites/landingpage/IntrinsicsGuide/)).

## Results

Run Time Analysis


### System Configuration
 *  CPU - Intel Core I7 6800K @ 3.4 [GHz].
 *  Memory - 4 * 8 [GB] @ 2166 [MHz] - G.Skill F4 2800C-16-8GRK.
 *  Mother Board - ASRock X99 Killer (BIOS Version P3.20).
 *  MATLAB R2018a.
    * BLAS Version (`version -blas`) - `Intel(R) Math Kernel Library Version 2017.0.31 Product Build 20170606 for Intel(R) 64 architecture applications, CNR branch AVX2`.
    * LAPACK Version (`version -lapack`) - `Intel(R) Math Kernel Library Version 2017.0.31 Product Build 20170606 for Intel(R) 64 architecture applications, CNR branch AVX2 Linear Algebra PACKage Version 3.7.0`.
 *  Windows 10 Professional 64 Bit (`Version 1709 (OS Build 16299.371)`).
 * Compilers:
    *   Microsoft Visual Studio Compiler (MSVC) 2017 version 15.6.6.
    *   GCC 7.3 from MinGW64 (See [MinGW Distro - nuwen.net](https://github.com/StephanTLavavej/mingw-distro)).
    *   Intel Compiler 2018 Update 2 (18.2).

## How to Run
Compile the from Visual Studio (Load the `CalcDistanceMatrix.sln` solution). Compile using MSVC / Intel. For GCC compilation use CMake (`CMakeLists.txt`).
Once all DLL's are in place, use `CalcDistanceMatrixUnitTest001.m` to validate the calculation accuracy and `CalcDistanceMatrixUnitTest002.m` to generate Run Time Analysis.  
In practice it seems the MATLAB overhead when claling Dynamic Library is order of magnitude larer the the Run Time.  
Hence one could use the Executables generated by compiles to asses the run time.


## ToDo
 * Try improve the Eigen implementation.
 * Expose 2 flavors of the Eigne implementation.